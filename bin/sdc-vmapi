#!/usr/bin/bash
#
# Copyright (c) 2013 Joyent Inc., All rights reserved.
#
# Convenience wrapper for calling VMAPI.
#

if [ "$TRACE" != "" ]; then
    export PS4='[\D{%FT%TZ}] ${BASH_SOURCE}:${LINENO}: ${FUNCNAME[0]:+${FUNCNAME[0]}(): }'
    set -o xtrace
fi
set -o errexit
set -o pipefail

if [[ ! -f /opt/smartdc/sdc/lib/libdc.sh ]]; then
    echo "sdc-vmapi: fatal: unable to find libdc.sh"
    exit 1
fi
source /opt/smartdc/sdc/lib/libdc.sh

path=$1
if [[ -z ${path} ]]; then
    cat <<EOF
error: no PATH argument given

Usage:
        $0 [--no-headers] PATH [EXTRA-CURL-ARGS]

EOF
    exit 1
fi

vmapi "$@" | json -q
exit $?
